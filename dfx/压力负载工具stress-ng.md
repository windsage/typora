# 负载模拟工具stress-ng

## 简介

stress-ng 是一个功能强大的 Linux 工具，专用于对系统进行压力测试和稳定性分析。它可以通过对 CPU、内存、磁盘 I/O、网络等多个子系统施加负载，帮助开发者和管理员检测系统的性能瓶颈、测试稳定性。



## 源码及Android binary

基于https://github.com/ColinIanKing/stress-ng tag V0.18.07 编译得到android arm64版本

二进制如下

[stress-ng](files/stress-ng)

## 使用方法

```plain&#x20;text
adb push stress-ng /data/local/tmp
adb push chmod a+x /data/local/tmp/stress-ng
// 版本信息
ECNO-CL8:/data/local/tmp $ ./stress-ng --version                                                                                                                                           
stress-ng, version 0.18.07 (clang 18.0.3, aarch64 Linux 5.10.209-android12-9-00017-g03a8268611be-ab12220661)                                                                           
TECNO-CL8:/data/local/tmp $ file stress-ng                                                                                                                                                  
stress-ng: ELF executable, 64-bit LSB arm64, static, for Android 34, built by NDK r27c (12479018), not stripped 
```



### 基本选项

| 选项                  | 描述                       |
| ------------------- | ------------------------ |
| --help              | 显示帮助信息，列出所有支持的选项和负载类型。   |
| --version           | 显示 stress-ng 的版本信息。      |
| --timeout \[time]   | 设置测试运行的时间（例如 60s、2m、1h）。 |
| --metrics-brief     | 在测试结束时输出简洁的性能统计信息。       |
| --verify            | 在运行压力测试时验证计算的准确性。        |
| --log-file \[file]  | 将测试的输出写入指定的日志文件中。        |



### 压力测试类型选项

每种压力类型可以用相应的选项指定，同时可以配置线程数、负载强度等。



#### CPU 和运算相关

| 选项                 | 描述                                               |
| ------------------ | ------------------------------------------------ |
| --cpu \[N]         | 运行 CPU 压力测试，指定线程数为 N。                            |
| --cpu-method \[M]  | 指定 CPU 压力测试的方法，例如 matrixprod 、sqrt、int64 ，默认all。 |
| --math \[N]        | 运行数学计算压力测试，使用 N 个线程。                             |
| --cpu-load \[N]    | 指定cpu负载\[0，100]（0休眠，100满载）                       |
| --cyclic-policy P  | 使用 rr 或 fifo 调度策略                                |
| --cyclic-prio N    | 实时调度优先级 1..100                                   |
| --taskset \[LIST]  | 设置亲核性                                            |



#### 内存相关

| 选项                 |  描述                             |
| ------------------ | ------------------------------- |
| --vm \[N]          | 分配内存并运行内存操作，使用 N 个线程。           |
| --vm-bytes \[size] | 每个线程分配的内存大小，例如 1G 或 512M。       |
| --vm-method \[M]   | 指定内存操作的方法，例如 all、write、touch 等。 |
|                    |                                 |



#### I/O 和文件系统相关

| 选项                  | 描述                   |
| ------------------- | -------------------- |
| --io \[N]           | 使用 N 个线程运行 I/O 压力测试。 |
| --hdd \[N]          | 模拟磁盘写操作，使用 N 个线程。    |
| --hdd-bytes \[size] | 每个线程写入的总数据大小。        |



#### 网络相关

| 选项           | 描述                  |
| ------------ | ------------------- |
| --sock \[N]  | 运行套接字压力测试，使用 N 个线程。 |
| --udp \[N]   |  使用 UDP 协议运行网络压力测试。 |



#### 其他子系统

| 选项           | 描述                    |
| ------------ | --------------------- |
| --fork \[N]  | 创建 N 个进程以测试进程创建和调度能力。 |
| --cache \[N] |  测试 CPU 缓存性能。         |
| --timer \[N] |  运行定时器相关的压力测试。        |

&#x20;     &#x20;

#### 组合和并行选项

| 选项                 | 描述                      |
| ------------------ | ----------------------- |
| --all \[N]         | 同时运行所有支持的压力测试，最多 N 个线程。 |
| --sequential \[L]  | 顺序运行指定负载列表，每种负载类型运行一次。  |

#### 负载控制选项

| 选项                 | 描述                           |
| ------------------ | ---------------------------- |
| --backoff \[time]  | 设置每个负载运行间的间隔时间，例如 1s。        |
| --cpu-load \[P]    | 设置 CPU 的负载百分比（例如 80 表示 80%）。 |
| --throttle \[T]    | 控制每个线程的负载节奏，T 为间隔时间。         |

&#x20;     &#x20;

#### 进阶统计和报告选项

| 选项        | 描述                        |
| --------- | ------------------------- |
| --metrics | 显示完整的测试指标，包括运行时间、负载信息等。   |
| --perf    | 使用 Linux perf 工具收集性能分析数据。 |
| --trace   | 打开函数调用的跟踪功能，用于调试。         |


欢迎发现更好选项联系添加